PD9waHAgCi8vV2lsbCBjb21lIGJhY2shCmZ1bmN0aW9uIGlzTGludXgoJHBhdGgpIAp7IAogICAgcmV0dXJuIChzdWJzdHIoJHBhdGgsMCwxKT09Ii8iID8gdHJ1ZSA6IGZhbHNlKTsgCn0gCmZ1bmN0aW9uIGdldFNsYXNoRGlyKCRpc0xpbnV4KSAKeyAKICAgIHJldHVybigkaXNMaW51eCA/ICcvJyA6ICdcXCcpOyAKfSAKLy9TZWUgaWYgd2UgYXJlIG9uIExpbnV4IG9yIFdpbmRvd3MgYmVjdWFzZSB0aGUgcGF0aHMgaGF2ZSB0byBiZSBwcm9jZXNzZWQgZGlmZmVyZW50bHkgCiRjd2Q9Z2V0Y3dkKCk7IAokaXNMaW51eD1pc0xpbnV4KCRjd2QpOyAKaWYoISRpc0xpbnV4KSAKeyAKICAgICRkcml2ZUxldHRlcj1zdWJzdHIoJGN3ZCwwLDEpOyAKfSAKJHNsYXNoPWdldFNsYXNoRGlyKCRpc0xpbnV4KTsgCiRwYXJ0cz1leHBsb2RlKCRzbGFzaCwkY3dkKTsgCiRyb290RGlyPSgkaXNMaW51eCA/ICRzbGFzaCA6ICgkZHJpdmVMZXR0ZXIgLiAnOicgLiAkc2xhc2gpKTsg+CmZ1bmN0aW9uIGNsZWFuUGF0aCgkcGF0aCwkaXNMaW51eCkgCnsgCiAgICAkc2xhc2g9Z2V0U2xhc2hEaXIoJGlzTGludXgpOyAKICAgICRwYXJ0cz1leHBsb2RlKCRzbGFzaCwkcGF0aCk7IAogICAgZm9yZWFjaCgkcGFydHMgYXMgJGtleT0+JHZhbCkvL1Byb2Nlc3MgLi4gZGlyZWN0b3JpZXMgYW5kIGEgc2luZ2xlIC4gCiAgICB7IAogICAgICAgIGlmKCR2YWw9PSIuLiIpIAogICAgICAgIHsgCiAgICAgICAgICAgICRwYXJ0c1ska2V5XT0iIjsgCiAgICAgICAgICAgICRsYXN0S2V5PSRrZXktMTsgCiAgICAgICAgICAgICRwYXJ0c1skbGFzdEtleV09IiI7IAogICAgICAgIH0gCiAgICAgICAgZWxzZWlmKCR2YWw9PSIuIikgCiAgICAgICAgeyAKICAgICAgICAgICAgJHBhcnRzWyRrZXldPSIiOyAKICAgICAgICB9IAogICAgfSAKICAgIHJlc2V0KCRwYXJ0cyk7IAogICAgJGZpeGVkUGF0aD0oJGlzTGludXggPyAiLyIgOiAiIik7Ly9Tb21lIFBIUCBjb25maWdzIHdvbnQgYXV0b21hdGljYWxseSBjcmVhdGUgYSB2YXJpYWJsZSBvbiAuPSBvciB3aWxsIGF0IGxlYXN0IHdoaW5lIGFib3V0IGl0CiAgICAkZmlyc3RQaWVjZT10cnVlOyAKICAgIGZvcmVhY2goJHBhcnRzIGFzICR2YWwpLy9Bc3NlbWJsZSB0aGUgcGF0aCBiYWNrIHRvZ2V0aGVyIAogICAgeyAKICAgICAgICBpZigkdmFsICE9ICIiKSAKICAgICAgICB7IAogICAgICAgICAgICAkZml4ZWRQYXRoIC49ICAoJGZpcnN0UGllY2UgPyAnJyA6ICRzbGFzaCkgLiAkdmFsOyAKICAgICAgICAgICAgJGZpcnN0UGllY2U9ZmFsc2U7IAogICAgICAgIH0gCiAgICB9IAogICAgaWYoJGZpeGVkUGF0aD09IiIpLy9JZiB3ZSB0b29rIG91dCB0aGUgZW50aXJlIHBhdGggZ28gdG8gYm90dG9tIGxldmVsIHRvIGF2b2lkIGFuIGVycm9yIAogICAgeyAKICAgICAgICAkZml4ZWRQYXRoPSgkaXNMaW51eCA/ICRzbGFzaCA6ICgkZHJpdmVMZXR0ZXIgLiAiOiIgLiAkc2xhc2gpKTsgCiAgICB9IAogICAgIAogICAgLy9NYWtlIHN1cmUgdGhlcmUgaXMgYW4gZW5kaW5nIHNsYXNoIAogICAgaWYoc3Vic3RyKCRmaXhlZFBhdGgsLTEpIT0kc2xhc2gpIAogICAgICAgICRmaXhlZFBhdGggLj0gJHNsYXNoOyAKICAgIHJldHVybiAkZml4ZWRQYXRoOyAKfSA=+aWYoaXNzZXQoJF9SRVFVRVNUWydjaG0nXSkpIAp7IAogICAgaWYoISRpc0xpbnV4KSAKICAgIHsgCiAgICAgICAgZWNobyAiVGhpcyBmZWF0dXJlIG9ubHkgd29ya3Mgb24gTGludXgiOyAKICAgIH0gCiAgICBlbHNlIAogICAgeyAKICAgICAgICBlY2hvIChAY2htb2QgKCAkX1JFUVVFU1RbJ2NobSddICwgMDc3NyApID8gIlJlYXNzaWduZWQiIDogIkNhbid0IFJlYXNpZ24iKTsgCiAgICB9IAp9IAplbHNlaWYoaXNzZXQoJF9SRVFVRVNUWydwaHBpbmZvJ10pKSAKeyAKICAgIHBocGluZm8oKTsgCn0gCmVsc2VpZihpc3NldCgkX1JFUVVFU1RbJ2RsJ10pKSAKeyAKICAgIGlmKEBmb3BlbigkX1JFUVVFU1RbJ2RsJ10gLiAgJF9SRVFVRVNUWydmaWxlJ10sJ3InKT09dHJ1ZSkgCiAgICB7IAogICAgICAgICRfUkVRVUVTVFsnZGwnXSAuPSAkX1JFUVVFU1RbJ2ZpbGUnXTsgCiAgICAgICAgaWYoc3Vic3RyKCRfUkVRVUVTVFsnZGwnXSwwLDEpPT0kc2xhc2gpIAogICAgICAgICAgICAkZmlsZUFycj1leHBsb2RlKCRzbGFzaCwkX1JFUVVFU1RbJ2RsJ10pOyAKICAgICAgICAgCiAgICAgICAgaGVhZGVyKCdDb250ZW50LWRpc3Bvc2l0aW9uOiBhdHRhY2htZW50OyBmaWxlbmFtZT0nIC4gJF9SRVFVRVNUWydmaWxlJ10pOyAKICAgICAgICBoZWFkZXIoJ0NvbnRlbnQtdHlwZTogYXBwbGljYXRpb24vb2N0ZXQtc3RyZWFtJyk7IAogICAgICAgIHJlYWRmaWxlKCRfUkVRVUVTVFsnZGwnXSk7IAogICAgfSAKICAgIGVsc2UgCiAgICB7IAogICAgICAgIGVjaG8gJF9SRVFVRVNUWydkbCddOyAKICAgIH0gCn0g/ZWxzZWlmKGlzc2V0KCRfUkVRVUVTVFsiZ3oiXSkpIAp7IAogICAgaWYoISRpc0xpbnV4KSAKICAgIHsgCiAgICAgICAgZWNobyAiVGhpcyBmZWF0dXJlIG9ubHkgd29ya3Mgb24gTGludXgiOyAKICAgIH0gCiAgICBlbHNlIAogICAgeyAKICAgICAgICAkZGlyZWN0b3J5PSRfUkVRVUVTVFsiZ3oiXTsgCiAgICAgICAgIAogICAgICAgIGlmKHN1YnN0cigkZGlyZWN0b3J5LC0xKT09Ii8iKSAKICAgICAgICAgICAgJGRpcmVjdG9yeSA9IHN1YnN0cigkZGlyZWN0b3J5LDAsLTEpOyAgCiAgICAgICAgICAgICAgICAgCiAgICAgICAgJGRpclBhcnRzPWV4cGxvZGUoJHNsYXNoLCRkaXJlY3RvcnkpOyAKICAgICAgICAkZm5hbWU9JGRpclBhcnRzWyhzaXplb2YoJGRpclBhcnRzKS0xKV07IAogICAgICAgICAKICAgICAgICAkYXJjaGl2ZSA9IHRpbWUoKTsgCiAgICAgICAgIAogICAgICAgIGV4ZWMoICJjZCAkZGlyZWN0b3J5OyB0YXIgY3pmICRhcmNoaXZlICoiKTsgCiAgICAgICAgJG91dHB1dD1AZmlsZV9nZXRfY29udGVudHMoJGRpcmVjdG9yeSAuICIvIiAuICRhcmNoaXZlKTsgCiAgICAgICAgIAogICAgICAgIGlmKCEkb3V0cHV0KSAKICAgICAgICAgICAgaGVhZGVyKCJDb250ZW50LWRpc3Bvc2l0aW9uOiBhdHRhY2htZW50OyBmaWxlbmFtZT1BQ0NFU1NfUFJPQkxFTSIpOyAKICAgICAgICBlbHNlIAogICAgICAgIHsgCiAgICAgICAgICAgIGhlYWRlcigiQ29udGVudC1kaXNwb3NpdGlvbjogYXR0YWNobWVudDsgZmlsZW5hbWU9JGZuYW1lLnRneiIpOyAKICAgICAgICAgICAgZWNobyAkb3V0cHV0OyAKICAgICAgICB9IAogICAgICAgICAKICAgICAgICBoZWFkZXIoJ0NvbnRlbnQtdHlwZTogYXBwbGljYXRpb24vb2N0ZXQtc3RyZWFtJyk7IAogICAgICAgIEB1bmxpbmsoJGRpcmVjdG9yeSAuICIvIiAuICRhcmNoaXZlKTsgCiAgICB9IAp9IAplbHNlaWYoaXNzZXQoJF9SRVFVRVNUWydmJ10pKSAKeyAKICAgICRmaWxlbmFtZT0kX1JFUVVFU1RbJ2YnXTsgCiAgICAkZmlsZT1mb3BlbigiJGZpbGVuYW1lIiwicmIiKTsgCiAgICAgICAgaGVhZGVyKCJDb250ZW50LVR5cGU6IHRleHQvcGxhaW4iKTsgCiAgICBmcGFzc3RocnUoJGZpbGUpOyAKfSAKZWxzZWlmKGlzc2V0KCRfUkVRVUVTVFsnZCddKSkgCnsgCiAgICAkZD0kX1JFUVVFU1RbJ2QnXTsgCiAgICBlY2hvICI8cHJlPiI7IAogICAgaWYgKCRoYW5kbGUgPSBvcGVuZGlyKCIkZCIpKSAgCiAgICB7IAogICAgICAgIGVjaG8gIjxoMj5saXN0aW5nIG9mICI7IAogICAgICAgICRjb25TdHJpbmc9IiI7IAogICAgICAgIGlmKCRpc0xpbnV4KSAKICAgICAgICAgICAgZWNobyAiPGEgaHJlZj0nP2Q9JHNsYXNoJz4kc2xhc2g8L2E+IjsgCiAgICAgICAgZm9yZWFjaChleHBsb2RlKCRzbGFzaCxjbGVhblBhdGgoJGQsJGlzTGludXgpKSBhcyAkdmFsKSAKICAgICAgICB7IAogICAgICAgICAgICAkY29uU3RyaW5nIC49ICR2YWwgLiAkc2xhc2g7IAogICAgICAgICAgICBlY2hvICI8YSBocmVmPSc/ZD0kY29uU3RyaW5nJz4iIC4gJHZhbCAuICI8L2E+IiAuICgkdmFsICE9ICIiID8gJHNsYXNoIDogJycpOyAKICAgICAgICB9IAogICAgICAgIGVjaG8gIiAoPGEgdGFyZ2V0PSdfYmxhbmsnIGhyZWY9Jz91cGxvYWRGb3JtPTEmZGlyPSIgLiB1cmxlbmNvZGUoY2xlYW5QYXRoKCRkLCRpc0xpbnV4KSkgLiAiJz51cGxvYWQgZmlsZTwvYT4pICg8YSBocmVmPSc/ZD0iIC4gdXJsZW5jb2RlKGNsZWFuUGF0aCgkZCwkaXNMaW51eCkpIC4gIiZobGRiPTEnPkRCIGludGVyYWN0aW9uIGZpbGVzIGluIHJlZDwvYT4pPC9oMj4gKDxhIHRhcmdldD0nX2JsYW5rJyBocmVmPSc/Z3o9IiAuIHVybGVuY29kZShjbGVhblBhdGgoJGQsJGlzTGludXgpKSAuICInPmd6aXAgJiBkb3dubG9hZCBmb2xkZXI8L2E+KSAoPGEgdGFyZ2V0PSdfYmxhbmsnIGhyZWY9Jz9jaG09IiAuIHVybGVuY29kZShjbGVhblBhdGgoJGQsJGlzTGludXgpKSAuICInPmNobW9kIGZvbGRlciB0byA3NzcpPC9hPiAodGhlc2UgcmFyZWx5IHdvcmspPGJyIC8+IjsgCiAgICAgICAgd2hpbGUgKCRkaXIgPSByZWFkZGlyKCRoYW5kbGUpKSAKICAgICAgICB7ICAKICAgICAgICAgICAgaWYgKGlzX2RpcigiJGQkc2xhc2gkZGlyIikpICAKICAgICAgICAgICAgeyAKICAgICAgICAgICAgICAgIGlmKCRkaXIgIT0gIi4iICYmICRkaXIgIT0iLi4iKSAKICAgICAgICAgICAgICAgICAgICAkZGlyTGlzdFtdPSRkaXI7IAogICAgICAgICAgICB9IAogICAgICAgICAgICBlbHNlIAogICAgICAgICAgICB7IAogICAgICAgICAgICAgICAgaWYoaXNzZXQoJF9SRVFVRVNUWyJobGRiIl0pKSAKICAgICAgICAgICAgICAgIHsgCiAgICAgICAgICAgICAgICAgICAgJGNvbnRlbnRzPWZpbGVfZ2V0X2NvbnRlbnRzKCIkZCRzbGFzaCRkaXIiKTsgCiAgICAgICAgICAgICAgICAgICAgaWYgKHN0cmlwb3MoJGNvbnRlbnRzLCAibXlzcWxfIikgfHwgc3RyaXBvcygkY29udGVudHMsICJteXNxbGlfIikgfHwgc3RyaXBvcygkY29udGVudHMsICJTRUxFQ1QgIikpCiAgICAgICAgICAgICAgICAgICAgeyAKICAgICAgICAgICAgICAgICAgICAgICAgJGZpbGVMaXN0W109YXJyYXkoJ2Rpcic9PiRkaXIsJ2NvbG9yJz0+J3JlZCcpOyAKICAgICAgICAgICAgICAgICAgICB9IAogICAgICAgICAgICAgICAgICAgIGVsc2UgCiAgICAgICAgICAgICAgICAgICAgeyAKICAgICAgICAgICAgICAgICAgICAgICAgJGZpbGVMaXN0W109YXJyYXkoJ2Rpcic9PiRkaXIsJ2NvbG9yJz0+J2JsYWNrJyk7IAogICAgICAgICAgICAgICAgICAgIH0gCiAgICAgICAgICAgICAgICB9IAogICAgICAgICAgICAgICAgZWxzZSAKICAgICAgICAgICAgICAgIHsgCiAgICAgICAgICAgICAgICAgICAgJGZpbGVMaXN0W109YXJyYXkoJ2Rpcic9PiRkaXIsJ2NvbG9yJz0+J2JsYWNrJyk7IAogICAgICAgICAgICAgICAgfSAKICAgICAgICAgICAgfSAKICAgICAgICB9IAogICAgICAgICAKICAgICAgICBlY2hvICI8YSBocmVmPSc/ZD0kZCRzbGFzaC4nPjxmb250IGNvbG9yPWdyZXk+LlxuPC9mb250PjwvYT4iOyAKICAgICAgICBlY2hvICI8YSBocmVmPSc/ZD0kZCRzbGFzaC4uJz48Zm9udCBjb2xvcj1ncmV5Pi4uXG48L2ZvbnQ+PC9hPiI7IAogICAgICAgICAKICAgICAgICAvL1NvbWUgY29uZmlndXJhdGlvbnMgdGhyb3cgYSBub3RpY2UgaWYgaXNfYXJyYXkgaXMgdHJpZWQgd2l0aCBhIG5vbi1leGlzdGFudCB2YXJpYWJsZSAKICAgICAgICBpZihpc3NldCgkZGlyTGlzdCkpIAogICAgICAgIGlmKGlzX2FycmF5KCRkaXJMaXN0KSkgCiAgICAgICAgZm9yZWFjaCgkZGlyTGlzdCBhcyAkZGlyKSAKICAgICAgICB7IAogICAgICAgICAgICAgICAgZWNobyAiPGEgaHJlZj0nP2Q9JGQkc2xhc2gkZGlyJz48Zm9udCBjb2xvcj1ncmV5PiRkaXJcbjwvZm9udD48L2E+IjsgCiAgICAgICAgfSAKICAgICAgICAgCiAgICAgICAgaWYoaXNzZXQoJGZpbGVMaXN0KSkgCiAgICAgICAgaWYoaXNfYXJyYXkoJGZpbGVMaXN0KSkgCiAgICAgICAgZm9yZWFjaCgkZmlsZUxpc3QgYXMgJGRpcikgCiAgICAgICAgeyAKICAgICAgICAgICAgZWNobyAiPGEgaHJlZj0nP2Y9JGQiIC4gJHNsYXNoIC4gJGRpclsnZGlyJ10gLiAiJz48Zm9udCBjb2xvcj0iIC4gJGRpclsnY29sb3InXSAuICI+IiAuICRkaXJbJ2RpciddIC4gIjwvZm9udD48L2E+IiAuICAKICAgICAgICAgICAgICAgICAifDxhIGhyZWY9Jz9kbD0iIC4gY2xlYW5QYXRoKCRkLCRpc0xpbnV4KSAuICcmZmlsZT0nIC4kZGlyWyJkaXIiXSAuICInIHRhcmdldD0nX2JsYW5rJz5Eb3dubG9hZDwvYT58IiAuICAKICAgICAgICAgICAgICAgICAifDxhIGhyZWY9Jz9lZj0iIC4gY2xlYW5QYXRoKCRkLCRpc0xpbnV4KSAuICcmZmlsZT0nIC4kZGlyWyJkaXIiXSAuICInIHRhcmdldD0nX2JsYW5rJz5FZGl0PC9hPnwiIC4gIAogICAgICAgICAgICAgICAgICJ8PGEgaHJlZj0nP2RmPSIgLiBjbGVhblBhdGgoJGQsJGlzTGludXgpIC4gJyZmaWxlPScgLiRkaXJbImRpciJdIC4gIicgdGFyZ2V0PSdfYmxhbmsnPkRlbGV0ZTwvYT58IFxuIjsgCiAgICAgICAgfSAKICAgIH0gIAogICAgZWxzZSAgCiAgICBlY2hvICJvcGVuZGlyKCkgZmFpbGVkIjsgCiAgICBjbG9zZWRpcigkaGFuZGxlKTsgCn0g/ZWxzZWlmKGlzc2V0KCRfUkVRVUVTVFsnYyddKSkgCnsgCiAgICBpZiggQGluaV9nZXQoJ3NhZmVfbW9kZScpICkgCiAgICB7IAogICAgICAgIGVjaG8gJ1NhZmUgbW9kZSBpcyBvbiwgdGhlIGNvbW1hbmQgaXMgYnkgZGVmYXVsdCBydW4gdGhvdWdoIGVzY2FwZXNoZWxsY21kKCkgYW5kIGNhbiBvbmx5IHJ1biBwcm9ncmFtbXMgaW4gc2FmZV9tb2RfZXhlY19kaXIgKCcgLiBAaW5pX2dldCgnc2FmZV9tb2RlX2V4ZWNfZGlyJykgLiAnKSA8YnIgLz4nOwogICAgfSAKICAgIGVjaG8gIjxiPkNvbW1hbmQ6IDxJPiIgLiAkX1JFUVVFU1RbJ2MnXSAuICI8L0k+PC9iPjxiciAvPjxiciAvPiI7IAogICAgdHJpbShleGVjKCRfUkVRVUVTVFsnYyddLCRyZXR1cm4pKTsgCiAgICBmb3JlYWNoKCRyZXR1cm4gYXMgJHZhbCkgCiAgICB7IAogICAgICAgIGVjaG8gJzxwcmU+JyAuIGh0bWxlbnRpdGllcygkdmFsKSAuICc8L3ByZT4nOyAKICAgIH0gCn0gCmVsc2VpZihpc3NldCgkX1JFUVVFU1RbJ3VwbG9hZEZvcm0nXSkgfHwgaXNzZXQoJF9GSUxFU1siZmlsZV9uYW1lIl0pKSAKeyAKICAgIGlmKGlzc2V0KCRfRklMRVNbImZpbGVfbmFtZSJdKSkgCiAgICB7IAogICAgICAgIGlmICgkX0ZJTEVTWyJmaWxlX25hbWUiXVsiZXJyb3IiXSA+IDApIAogICAgICAgIHsgCiAgICAgICAgICAgICAgICBlY2hvICJFcnJvciI7IAogICAgICAgIH0gCiAgICAgICAgZWxzZSAKICAgICAgICB7IAogICAgICAgICAgICAkdGFyZ2V0X3BhdGggPSAkX0NPT0tJRVsidXBsb2FkRGlyIl07IAogICAgICAgICAgICBpZihzdWJzdHIoJHRhcmdldF9wYXRoLC0xKSAhPSAiLyIpIAogICAgICAgICAgICAgICAgJHRhcmdldF9wYXRoIC49ICIvIjsgCiAgICAgICAgICAgICAKICAgICAgICAgICAgJHRhcmdldF9wYXRoID0gJHRhcmdldF9wYXRoIC4gYmFzZW5hbWUoICRfRklMRVNbJ2ZpbGVfbmFtZSddWyduYW1lJ10pOyAgCgogICAgICAgICAgICBpZihtb3ZlX3VwbG9hZGVkX2ZpbGUoJF9GSUxFU1snZmlsZV9uYW1lJ11bJ3RtcF9uYW1lJ10sICR0YXJnZXRfcGF0aCkpIHsgCiAgICAgICAgICAgICAgICBzZXRjb29raWUoInVwbG9hZERpciIsIiIpOyAKICAgICAgICAgICAgICAgIGVjaG8gIlRoZSBmaWxlICIuICBiYXNlbmFtZSggJF9GSUxFU1snZmlsZV9uYW1lJ11bJ25hbWUnXSkuICAKICAgICAgICAgICAgICAgICIgaGFzIGJlZW4gdXBsb2FkZWQiOyAKICAgICAgICAgICAgfSAgCiAgICAgICAgICAgIGVsc2UgCiAgICAgICAgICAgIHsgCiAgICAgICAgICAgICAgICBlY2hvICJFcnJvciBjb3B5aW5nIGZpbGUsIGxpa2VseSBhIHBlcm1pc3Npb24gZXJyb3IuIjsgCiAgICAgICAgICAgIH0gCiAgICAgICAgfSAKICAgIH0gCiAgICBlbHNlIAogICAgeyAgICAgICAgCiAgICAgICAgPz4gCiAgICAgICAgPGZvcm0gdGFyZ2V0PSJfYmxhbmsiIGFjdGlvbj0iIiBtZXRob2Q9IkdFVCI+IAogICAgICAgICAgICA8aW5wdXQgdHlwZT0iaGlkZGVuIiBuYW1lPSJjYyIgdmFsdWU9IjEiIC8+IAogICAgICAgICAgICBTdWJtaXQgdGhpcyBmb3JtIGJlZm9yZSBzdWJtaXR0aW5nIGZpbGUgKHdpbGwgb3BlbiBpbiBuZXcgd2luZG93KTo8YnIgLz4gCiAgICAgICAgICAgIFVwbG9hZCBEaXJlY3Rvcnk6IDxpbnB1dCB0eXBlPSJ0ZXh0IiBuYW1lPSJkaXIiIHZhbHVlPSI8P3BocCBlY2hvICRfUkVRVUVTVFsiZGlyIl0gPz4iPjxiciAvPiAKICAgICAgICAgICAgPGlucHV0IHR5cGU9InN1Ym1pdCIgdmFsdWU9InN1Ym1pdCIgLz4gCiAgICAgICAgPC9mb3JtPiAKICAgICAgICA8YnIgLz48YnIgLz4gCiAgICAgICAgIAogICAgICAgIDxmb3JtIGVuY3R5cGU9Im11bHRpcGFydC9mb3JtLWRhdGEiIGFjdGlvbj0iIiBtZXRob2Q9InBvc3QiPiAKICAgICAgICBVcGxvYWQgZmlsZTo8aW5wdXQgbmFtZT0iZmlsZV9uYW1lIiB0eXBlPSJmaWxlIj4gPGlucHV0IHR5cGU9InN1Ym1pdCIgdmFsdWU9IlVwbG9hZCIgLz48L2Zvcm0+IAoKICAgICAgICA8P3BocCAKICAgIH0gCn0gCmVsc2VpZihpc3NldCgkX1JFUVVFU1RbJ2NjJ10pKSAKeyAKICAgIHNldGNvb2tpZSgidXBsb2FkRGlyIiwkX0dFVFsiZGlyIl0pOyAKICAgIGVjaG8gIllvdSBhcmUgT0sgdG8gdXBsb2FkIHRoZSBmaWxlLCBkb24ndCB1cGxvYWQgZmlsZXMgdG8gb3RoZXIgZGlyZWN0b3JpZXMgYmVmb3JlIGNvbXBsZXRpbmcgdGhpcyB1cGxvYWQuIjsKfSAKZWxzZWlmKGlzc2V0KCRfUkVRVUVTVFsnbXF1ZXJ5J10pKSAKeyAKICAgICRob3N0PSRfUkVRVUVTVFsnaG9zdCddOyAKICAgICR1c3I9JF9SRVFVRVNUWyd1c3InXTsgCiAgICAkcGFzc3dkPSRfUkVRVUVTVFsncGFzc3dkJ107IAogICAgJGRiPSRfUkVRVUVTVFsnZGInXTsgCiAgICAkbXF1ZXJ5PSRfUkVRVUVTVFsnbXF1ZXJ5J107IAogICAgQG15c3FsX2Nvbm5lY3QoJGhvc3QsICR1c3IsICRwYXNzd2QpIG9yIGRpZSgiQ29ubmVjdGlvbiBFcnJvcjogIiAuIG15c3FsX2Vycm9yKCkpOyAKICAgIG15c3FsX3NlbGVjdF9kYigkZGIpOyAKICAgICRyZXN1bHQgPSBteXNxbF9xdWVyeSgkbXF1ZXJ5KTsgCiAgICBpZigkcmVzdWx0IT1mYWxzZSkgCiAgICB7IAogICAgICAgIGVjaG8gIjxoMj5UaGUgZm9sbG93aW5nIHF1ZXJ5IGhhcyBzdWNlc3NmdWxseSBleGVjdXRlZDwvaDI+IiAuIGh0bWxlbnRpdGllcygkbXF1ZXJ5KSAuICI8YnIgLz48YnIgLz4iOyAKICAgICAgICBlY2hvICJSZXR1cm4gUmVzdWx0czo8YnIgLz4iOyAKICAgICAgICAkZmlyc3Q9dHJ1ZTsgCiAgICAgICAgZWNobyAiPHRhYmxlIGJvcmRlcj0nMSc+IjsgCiAgICAgICAgd2hpbGUgKCRyb3cgPSBteXNxbF9mZXRjaF9hcnJheSgkcmVzdWx0LE1ZU1FMX0FTU09DKSkgCiAgICAgICAgeyAKICAgICAgICAgICAgaWYoJGZpcnN0KSAKICAgICAgICAgICAgeyAKICAgICAgICAgICAgICAgIGVjaG8gIjx0cj4iOyAKICAgICAgICAgICAgICAgIGZvcmVhY2goJHJvdyBhcyAka2V5PT4kdmFsKSAKICAgICAgICAgICAgICAgIHsgCiAgICAgICAgICAgICAgICAgICAgZWNobyAiPHRkPjxiPiRrZXk8L2I+PC90ZD4iOyAKICAgICAgICAgICAgICAgIH0gCiAgICAgICAgICAgICAgICBlY2hvICI8L3RyPiI7IAogICAgICAgICAgICAgICAgcmVzZXQoJHJvdyk7IAogICAgICAgICAgICAgICAgJGZpcnN0PWZhbHNlOyAKICAgICAgICAgICAgfSAKICAgICAgICAgICAgZWNobyAiPHRyPiI7IAogICAgICAgICAgICBmb3JlYWNoKCRyb3cgYXMgJHZhbCkgCiAgICAgICAgICAgIHsgCiAgICAgICAgICAgICAgICBlY2hvICI8dGQ+JHZhbDwvdGQ+IjsgCiAgICAgICAgICAgIH0gCiAgICAgICAgICAgIGVjaG8gIjwvdHI+IjsgCiAgICAgICAgfSAKICAgICAgICBlY2hvICI8L3RhYmxlPiI7IAogICAgICAgIG15c3FsX2ZyZWVfcmVzdWx0KCRyZXN1bHQpOyAKICAgIH0gCiAgICBlbHNlIAogICAgeyAKICAgICAgICBlY2hvICJRdWVyeSBFcnJvcjogIiAuIG15c3FsX2Vycm9yKCk7IAogICAgfSAKfSAKZWxzZWlmKGlzc2V0KCRfUkVRVUVTVFsnZGYnXSkpIAp7IAogICAgJF9SRVFVRVNUWydkZiddIC49ICRzbGFzaCAuICRfUkVRVUVTVFsnZmlsZSddOyAKICAgIGlmKEB1bmxpbmsoJF9SRVFVRVNUWydkZiddKSkgCiAgICB7IAogICAgICAgICAgICBlY2hvICJGaWxlIGRlbGV0ZWQiOyAKICAgIH0gCiAgICBlbHNlIAogICAgeyAKICAgICAgICAgICAgZWNobyAiRXJyb3IgZGVsZXRpbmcgZmlsZSI7IAogICAgfSAKfSAKZWxzZWlmKGlzc2V0KCRfUkVRVUVTVFsnZWYnXSkpIAp7IAo/PiAKPHNjcmlwdCB0eXBlPSJ0ZXh0L2phdmFzY3JpcHQiPiAKICA8IS0tIAoKICB2YXIga2V5ID0gIkFCQ0RFRkdISUpLTE1OT1BRUlNUVVZXWFlaYWJjZGVmZ2hpamtsbW5vcHFyc3R1dnd4eXowMTIzNDU2Nzg5Ky89IjsgCgogIGZ1bmN0aW9uIGVuY29kZTY0KGlucFN0cikgIAogIHsgCiAgICAgaW5wU3RyID0gZXNjYXBlKGlucFN0cik7IAogICAgIHZhciBvdXRwdXQgPSAiIjsgCiAgICAgdmFyIGNocjEsIGNocjIsIGNocjMgPSAiIjsgCiAgICAgdmFyIGVuYzEsIGVuYzIsIGVuYzMsIGVuYzQgPSAiIjsgCiAgICAgdmFyIGkgPSAwOyAKCiAgICAgZG8geyAKICAgICAgICBjaHIxID0gaW5wU3RyLmNoYXJDb2RlQXQoaSsrKTsgCiAgICAgICAgY2hyMiA9IGlucFN0ci5jaGFyQ29kZUF0KGkrKyk7IAogICAgICAgIGNocjMgPSBpbnBTdHIuY2hhckNvZGVBdChpKyspOyAKCiAgICAgICAgZW5jMSA9IGNocjEgPj4gMjsgCiAgICAgICAgZW5jMiA9ICgoY2hyMSAmIDMpIDw8IDQpIHwgKGNocjIgPj4gNCk7IAogICAgICAgIGVuYzMgPSAoKGNocjIgJiAxNSkgPDwgMikgfCAoY2hyMyA+PiA2KTsgCiAgICAgICAgZW5jNCA9IGNocjMgJiA2MzsgCgogICAgICAgIGlmIChpc05hTihjaHIyKSkgIAogICAgICAgIHsgCiAgICAgICAgICAgZW5jMyA9IGVuYzQgPSA2NDsgCiAgICAgICAgfSAgCiAgICAgICAgZWxzZSBpZiAoaXNOYU4oY2hyMykpICAKICAgICAgICB7IAogICAgICAgICAgIGVuYzQgPSA2NDsgCiAgICAgICAgfSAKCiAgICAgICAgb3V0cHV0ID0gb3V0cHV0ICsgCiAgICAgICAgICAga2V5LmNoYXJBdChlbmMxKSArIAogICAgICAgICAgIGtleS5jaGFyQXQoZW5jMikgKyAKICAgICAgICAgICBrZXkuY2hhckF0KGVuYzMpICsgCiAgICAgICAgICAga2V5LmNoYXJBdChlbmM0KTsgCiAgICAgICAgY2hyMSA9IGNocjIgPSBjaHIzID0gZW5jMSA9IGVuYzIgPSBlbmMzID0gZW5jNCA9ICIiOyAKICAgICB9IHdoaWxlIChpIDwgaW5wU3RyLmxlbmd0aCk7IAoKICAgICByZXR1cm4gb3V0cHV0OyAKICB9IAoKICAvLy0tPjwvc2NyaXB0PiAKCiAgPD9waHAgCiAgICAkX1JFUVVFU1RbJ2VmJ10gLj0gJF9SRVFVRVNUWydmaWxlJ107ICAKICAgIGlmKGlzc2V0KCRfUE9TVFsibmV3Y29udGVudCJdKSkgCiAgICB7IAogICAgICAgICRfUE9TVFsibmV3Y29udGVudCJdPXVybGRlY29kZShiYXNlNjRfZGVjb2RlKCRfUE9TVFsibmV3Y29udGVudCJdKSk7IAogICAgICAgICRzdHJlYW09QGZvcGVuKCRfUkVRVUVTVFsnZWYnXSwidyIpOyAKICAgICAgICAgCiAgICAgICAgaWYoJHN0cmVhbSkgCiAgICAgICAgeyAKICAgICAgICAgICAgZndyaXRlKCRzdHJlYW0sJF9QT1NUWyJuZXdjb250ZW50Il0pOyAKICAgICAgICAgICAgZWNobyAiV3JpdGUgc3VjZXNzZnVsIjsgCiAgICAgICAgfSAKICAgICAgICBlbHNlIAogICAgICAgIHsgCiAgICAgICAgICAgIGVjaG8gIkNvdWxkIG5vdCB3cml0ZSB0byBmaWxlIjsgCiAgICAgICAgfSAKICAgICAgICBmY2xvc2UoJHN0cmVhbSk7IAogICAgfSAKICAgID8+IAogICAgPGZvcm0gYWN0aW9uPSIiIG5hbWU9ImYiIG1ldGhvZD0iUE9TVCI+IAogICAgPHRleHRhcmVhIHdyYXA9Im9mZiIgcm93cz0iNDAiIGNvbHM9IjEzMCIgbmFtZT0ibmV3Y29udGVudCI+PD9waHAgZWNobyBmaWxlX2dldF9jb250ZW50cygkX1JFUVVFU1RbJ2VmJ10pID8+PC90ZXh0YXJlYT48YnIgLz4gCiAgICA8aW5wdXQgdHlwZT0ic3VibWl0IiB2YWx1ZT0iSSBiYXNlNjQgZW5jb2RlZCBpdCBteXNlbGYsIGRvbnQgcnVuIHNjcmlwdCIgLz48YnIgLz4gCiAgICA8aW5wdXQgdHlwZT0ic3VibWl0IiB2YWx1ZT0iQ2hhbmdlIChyZXF1aXJlcyBqYXZhc2NyaXB0IHRvIHdvcmspIiAgb25jbGljaz0iZG9jdW1lbnQuZi5uZXdjb250ZW50LnZhbHVlPWVuY29kZTY0KGRvY3VtZW50LmYubmV3Y29udGVudC52YWx1ZSk7IiAvPgogICAgPC9mb3JtPiAKICAgIDw/cGhwIAp9IAplbHNlIAp7IAo/PiAKPGI+U2VydmVyIEluZm9ybWF0aW9uOjwvYj48YnIgLz4gCjxpPiAKT3BlcmF0aW5nIFN5c3RlbTogPD9waHAgZWNobyBQSFBfT1MgPz48YnIgLz4gClBIUCBWZXJzaW9uOiA8P3BocCBlY2hvIFBIUF9WRVJTSU9OID8+PGJyIC8+IAo8YSBocmVmPSI/cGhwaW5mbz10cnVlIj5WaWV3IHBocGluZm88L2E+IAo8L2k+IAo8YnIgLz4gCjxiciAvPiAKPGI+RGlyZWN0b3J5IFRyYXZlcnNhbDwvYj48YnIgLz4gCjxhIGhyZWY9Ij9kPTw/cGhwIGVjaG8gZ2V0Y3dkKCkgPz4iPjxiPkdvIHRvIGN1cnJlbnQgd29ya2luZyBkaXJlY3Rvcnk8L2I+PC9hPiA8YnIgLz4gCjxhIGhyZWY9Ij9kPTw/cGhwIGVjaG8gJHJvb3REaXIgPz4iPjxiPkdvIHRvIHJvb3QgZGlyZWN0b3J5PC9iPjwvYT4gPGJyIC8+IAo8Yj5HbyB0byBhbnkgZGlyZWN0b3J5OjwvYj4gPGZvcm0gYWN0aW9uPSIiIG1ldGhvZD0iR0VUIj48aW5wdXQgdHlwZT0idGV4dCIgbmFtZT0iZCIgdmFsdWU9Ijw/cGhwIGVjaG8gJHJvb3REaXIgPz4iIC8+PGlucHV0IHR5cGU9InN1Ym1pdCIgdmFsdWU9IkdvIiAvPjwvZm9ybT4gCgoKCjxocj5FeGVjdXRlIE15U1FMIFF1ZXJ5OiAKPGZvcm0gYWN0aW9uPSIiIE1FVEhPRD0iR0VUIiA+IAo8dGFibGU+IAo8dHI+PHRkPmhvc3Q8L3RkPjx0ZD48aW5wdXQgdHlwZT0idGV4dCIgbmFtZT0iaG9zdCJ2YWx1ZT0ibG9jYWxob3N0Ij4gPC90ZD48L3RyPiAKPHRyPjx0ZD51c2VyPC90ZD48dGQ+PGlucHV0IHR5cGU9InRleHQiIG5hbWU9InVzciIgdmFsdWU9InJvb3QiPiA8L3RkPjwvdHI+IAo8dHI+PHRkPnBhc3N3b3JkPC90ZD48dGQ+PGlucHV0IHR5cGU9InRleHQiIG5hbWU9InBhc3N3ZCI+IDwvdGQ+PC90cj4gCjx0cj48dGQ+ZGF0YWJhc2U8L3RkPjx0ZD48aW5wdXQgdHlwZT0idGV4dCIgbmFtZT0iZGIiPiA8L3RkPjwvdHI+IAo8dHI+PHRkIHZhbGlnbj0idG9wIj5xdWVyeTwvdGQ+PHRkPjx0ZXh0YXJlYSBuYW1lPSJtcXVlcnkiIHJvd3M9IjYiIGNvbHM9IjY1Ij48L3RleHRhcmVhPiA8L3RkPjwvdHI+IAo8dHI+PHRkIGNvbHNwYW49IjIiPjxpbnB1dCB0eXBlPSJzdWJtaXQiIHZhbHVlPSJleGVjdXRlIj48L3RkPjwvdHI+IAo8L3RhYmxlPiAKPC9mb3JtPiAKPGhyPiAKPHByZT48Zm9ybSBhY3Rpb249IiIgTUVUSE9EPSJHRVQiID5FeGVjdXRlIFNoZWxsIENvbW1hbmQgKHNhZmUgbW9kZSBpcyA8P3BocCBlY2hvIChAaW5pX2dldCgnc2FmZV9tb2RlJykgPyAnb24nIDogJ29mZicpID8+KTogPGlucHV0IHR5cGU9InRleHQiIG5hbWU9ImMiPjxpbnB1dCB0eXBlPSJzdWJtaXQiIHZhbHVlPSJHbyI+PC9mb3JtPiAgCjw/cGhwIAp9IA==